// MIT, Extension for Firefox 4+ Browser - Click&Clean - HOTCLEANER.COM - Vlad and Serge Strukoff

// ==ClosureCompiler==
// @compilation_level SIMPLE_OPTIMIZATIONS

var clickClean;addEventListener("load",function(){clickClean=new ClickClean},!1);
function ClickClean(){function l(b){function a(){l&&r.clearTimeout(l);(m||n)&&y(t,u,j,k)}function e(){function b(){d.label=label+" ("+e+")";1>e?c.acceptDialog():(--e,l=r.setTimeout(b,1E3))}var c=r.document.getElementsByTagName("prefwindow")[0],d,e;r.addEventListener("unload",a,!1);if(1>s)c.acceptDialog();else if(!(7<s)&&(d=c.getButton("accept")))e=s,label=d.label,b()}function d(a){return f["@mozilla.org/appshell/window-mediator;1"].getService(g.nsIWindowMediator).getMostRecentWindow(a)}var f=Components.classes,
g=Components.interfaces,j,k,l=0,r,v=!0,w=!1,z=!0,s=8,m=!1,n=!1,t="",u="",h=!1,c=!1,p=!1;(c=d("ccOptions"))?(c=c.document,v=c.getElementById("san-enabled").checked,w=c.getElementById("san-close").checked,z=c.getElementById("san-ask").checked,s=c.getElementById("san-time").selectedIndex,m=c.getElementById("ext-sanitize").checked,n=c.getElementById("ext-close").checked,t=c.getElementById("ext-path").value,u=c.getElementById("ext-arg").value,p=c.getElementById("adv-lso").checked,h=c.getElementById("adv-tabs").checked,
c=c.getElementById("adv-tab").checked):(c=f["@mozilla.org/preferences-service;1"].getService(g.nsIPrefService).getBranch("extensions.clickclean."),v=c.getBoolPref("sanitize"),w=c.getBoolPref("close"),z=c.getBoolPref("showPrompt"),s=c.getIntPref("wait"),m=c.getBoolPref("useExt"),n=c.getBoolPref("closeExt"),t=c.getComplexValue("path",g.nsISupportsString).data,u=c.getComplexValue("arg",g.nsISupportsString).data,p=c.getBoolPref("lso"),h=c.getBoolPref("tabs"),c=c.getBoolPref("tab"));if(m||n)k=f["@mozilla.org/file/local;1"].createInstance(g.nsILocalFile),
j=f["@mozilla.org/process/util;1"].createInstance(g.nsIProcess);if(b){if(d("navigator:browser"))return;h=m=v=!1}else w=n=!1;h&&x(c);if(p){b=function(){try{A.initWithPath(q),A.exists&&A.remove(!0)}catch(a){}};var h=f["@mozilla.org/xre/app-info;1"].getService(g.nsIXULRuntime).OS.toLowerCase(),p=f["@mozilla.org/file/directory_service;1"].getService(g.nsIProperties),A=f["@mozilla.org/file/local;1"].createInstance(g.nsILocalFile),q;"linux"==h?(h=p.get("Home",g.nsIFile),q=h.path+"/.macromedia/Flash_Player/#SharedObjects",
b(),q=h.path+"/.macromedia/Flash_Player/macromedia.com/support/flashplayer/sys"):"darwin"==h?(h=p.get("ULibDir",g.nsIFile),q=h.path+"/Preferences/Macromedia/Flash Player/#SharedObjects",b(),q=h.path+"/Preferences/Macromedia/Flash Player/macromedia.com/support/flashplayer/sys"):(h=p.get("AppData",g.nsIFile),q=h.path+"\\Macromedia\\Flash Player\\#SharedObjects",b(),q=h.path+"\\Macromedia\\Flash Player\\macromedia.com\\support\\flashplayer\\sys");b()}v||w?!v&&!w?(m||n)&&y(t,u,j,k):(z||(s=0),r=f["@mozilla.org/embedcomp/window-watcher;1"].getService(g.nsIWindowWatcher).openWindow(null,
"chrome://browser/content/sanitize.xul",null,"chrome,centerscreen",null),r.addEventListener("load",e,!1)):(m||n)&&y(t,u,j,k)}function y(b,a,e,d){b&&(e=e?e:Components.classes["@mozilla.org/process/util;1"].createInstance(Components.interfaces.nsIProcess),d=d?d:Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile),d.initWithPath(b),e.init(d),e.run(!1,[a],1))}function x(b){var a=Components.classes["@mozilla.org/appshell/window-mediator;1"].getService(Components.interfaces.nsIWindowMediator),
e=a.getMostRecentWindow("navigator:browser"),a=a.getEnumerator(""),d;if(a)for(;a.hasMoreElements();)if(d=a.getNext(),d==e){var f=d.gBrowser,g=f.tabContainer;b||(f.selectedTab=f.addTab("about:blank"));d=g.childNodes;for(var j=0,k=d.length-1;j<k;j++)f.removeTab(d[0].selected?d[1]:d[0]),d=g.childNodes}else d.close()}function k(b){var a=Components.classes["@mozilla.org/appshell/window-mediator;1"].getService(Components.interfaces.nsIWindowMediator).getMostRecentWindow("navigator:browser").gBrowser;b=
a.addTab(b);return a.selectedTab=b}function B(){window.gPrivateBrowsingUI&&window.gPrivateBrowsingUI.toggleMode?window.gPrivateBrowsingUI.toggleMode():window.OpenBrowserWindow({"private":!0})}function D(){function b(b){f=a.get(b,Components.interfaces.nsIFile).path+d;e.initWithPath(f);return e.exists()}var a=Components.classes["@mozilla.org/file/directory_service;1"].getService(Components.interfaces.nsIProperties),e=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile),
d="\\Google\\Chrome\\Application\\chrome.exe",f;if(!b("LocalAppData")&&!b("ProgF"))return 0;y(f,"--install-from-webstore=ghgabhipcejejjmhhchfonmamedcbeod")}var C;this.onCmd=function(b){if(b.target.value){var a=parseInt(b.target.value);1==a?l():2==a?x(1):3==a?x():4==a?B():5==a?k("http://www.hotcleaner.com/clickclean-app.html"):6==a?k("about:cache"):7==a?openDialog("chrome://browser/content/preferences/cookies.xul","_new","chrome,centerscreen"):8==a?k("about:permissions"):9==a?openDialog("chrome://clickclean/content/options.xul",
"_new","chrome,centerscreen"):10==a?k("http://hotcleaner.com/security-and-privacy-software-feedback.html"):11==a&&k("http://www.hotcleaner.com/clickclean_firefox.html")}else"clickclean-button"==b.target.id&&l();b.stopPropagation()};this.onKey=function(b){if(b.target.id){var a=parseInt(b.target.id.slice(5));1==a?l():2==a?x(1):3==a?x():4==a&&B()}b.stopPropagation()};this.onPopupShowing=function(b){if(!C){C=1;var a;a=function(a){f=a;d.initWithPath(f);return d.exists()};if("Win32"==navigator.platform){var e=
Components.classes["@mozilla.org/file/directory_service;1"].getService(Components.interfaces.nsIProperties).get("LocalAppData",Components.interfaces.nsIFile).path+"\\Google\\Chrome\\User Data",d=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile),f;a=!a(e+"\\Default")&&!a(e+"\\Profile 1")?0:a(f+"\\Extensions\\ghgabhipcejejjmhhchfonmamedcbeod")?1:2}else a=void 0;2==a&&(b=b.target,a=b.getElementsByTagName("menuitem")[10],e=document.createElement("menuitem"),
e.setAttribute("id","clickclean-chrome"),e.setAttribute("class","menuitem-iconic"),e.setAttribute("image","chrome://clickclean/skin/chrome16.png"),e.setAttribute("label","Add Click&Clean to Google Chrome\u2122"),e.addEventListener("click",D,!1),b.insertBefore(e,a),a.style.display="none")}};addEventListener("unload",function(){l(1)},!1);var j=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefService).getBranch("extensions.clickclean.");if(4100!=j.getIntPref("v")){j.setIntPref("v",
4100);if(!document.getElementById("clickclean-button")&&(j=document.getElementById("nav-bar")))j.insertItem("clickclean-button",document.getElementById("search-container")),j.setAttribute("currentset",j.currentSet),document.persist(j.id,"currentset");setTimeout(function(){var b=gBrowser.getBrowserForTab(k("http://www.hotcleaner.com/clickclean_firefox.html"));b.addEventListener("load",function(){var a=b.contentDocument.getElementById("newVer");a&&(a.style.display="block",a.textContent="The new Click&Clean version 4.1 has been installed successfully!")},
!0)},2E3)}};